<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Trading Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: system-ui, Arial;
            margin: 24px
        }

        button {
            padding: 8px 12px;
            margin: 6px
        }

        canvas {
            max-width: 100%;
            height: 300px;
        }
    </style>
</head>

<body>
    <h2>Trading Engine Dashboard</h2>
    <div>
        <button onclick="start()">Start</button>
        <button onclick="stop()">Stop</button>
        <button onclick="refreshMetrics()">Refresh Metrics</button>
    </div>
    <div>
        Orders: <span id="orders">0</span> | Trades: <span id="trades">0</span> | Runs: <span id="runs">0</span>
    </div>
    <canvas id="chart"></canvas>
    <script>
        let chart;
        async function fetchCandles() {
            const res = await fetch('/api/candles?symbol=BTCUSD&limit=100');
            return await res.json();
        }
        async function fetchMetrics() {
            const res = await fetch('/api/metrics');
            return await res.json();
        }
        async function renderChart() {
            const candles = await fetchCandles();
            if (candles){
                const labels = candles.map(c => c.time);
                const data = {
                    labels: labels,
                    datasets: [
                        { label: 'Close', data: candles.map(c => c.close), borderColor: 'blue', backgroundColor: 'rgba(0,0,255,0.2)' },
                        { label: 'Open', data: candles.map(c => c.open), borderColor: 'green', backgroundColor: 'rgba(0,255,0,0.2)' }
                    ]
                };
            }
            if (chart) { chart.data = data; chart.update(); }
            else {
                const ctx = document.getElementById('chart').getContext('2d');
                chart = new Chart(ctx, { type: 'line', data: data });
            }
        }
        async function refreshMetrics() {
            const m = await fetchMetrics();
            document.getElementById('orders').innerText = m.orders;
            document.getElementById('trades').innerText = m.trades;
            document.getElementById('runs').innerText = m.runs;
        }
        async function start() { await fetch('/api/start', { method: 'POST' }); }
        async function stop() { await fetch('/api/stop', { method: 'POST' }); }
        setInterval(() => { renderChart(); refreshMetrics(); }, 3000);
        window.onload = () => { renderChart(); refreshMetrics(); };
    </script>
</body>

</html>